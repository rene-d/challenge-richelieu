#! /bin/sh

# lance le script courant dans un container Docker
if [[ $$ -ne 1 ]]
then
    docker build --tag alpine-gcc .
    docker run --rm -ti -v $PWD:/work -w /work alpine-gcc ./$(basename $0)
    exit
fi

echo -e "\033[33m=== crack ===\033[0m"
cc -o /tmp/crack crack.c
/tmp/crack
passphrase=$(/tmp/crack)

echo -e "\033[33m=== vérification (challenge) ===\033[0m"
./prog.bin ${passphrase}

echo -e "\033[33m=== vérification (reverse-engineering) ===\033[0m"
cc -o /tmp/prog prog.c
/tmp/prog ${passphrase}

echo -e "\033[33m=== reconstitution ===\033[0m"
cc -o /tmp/gen-table gen-table.c
/tmp/gen-table ${passphrase}
